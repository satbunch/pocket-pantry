---
tags: 
created: 2025-08-05 10:25
updated: 2025-08-07 10:07
---
旧：[[テーブル定義書 v.1.00]]
# PocketPantry テーブル定義書（MVP拡張版 v.1.02）

## families テーブル

| フィールド名       | 型    | 制約               | 説明                 |
| ------------ | ---- | ---------------- | ------------------ |
| id           | UUID | PK, NOT NULL     | ファミリーID（招待コードにも使用） |
| name         | text | NOT NULL         | ファミリーネーム           |
| avatar\_url  | text | NULLABLE         | アイコン画像URL          |
| invite\_code | text | NOT NULL, UNIQUE | 招待コード（人が読める文字列）    |

## profiles テーブル

| フィールド名     | 型    | 制約                        | 説明                   |
| ---------- | ---- | ------------------------- | -------------------- |
| id         | UUID | PK, NOT NULL              | Supabase AuthのユーザーID |
| family\_id | UUID | FK(families.id), NOT NULL | 所属ファミリーID            |
| name       | text | NOT NULL                  | ユーザー表示名              |

## items テーブル

| フィールド名              | 型         | 制約                            | 説明                           |
| ------------------- | --------- | ----------------------------- | ---------------------------- |
| id                  | UUID      | PK, NOT NULL                  | 食材ID                         |
| family\_id          | UUID      | FK(families.id), NOT NULL     | 所属ファミリーID                    |
| name                | text      | NOT NULL                      | 食材名                          |
| storage\_category   | text      | NOT NULL                      | 保存場所（冷蔵／冷凍／常温／野菜室）           |
| quantity            | integer   | NOT NULL, DEFAULT 1           | 在庫数                          |
| unit\_id            | UUID      | FK(unit\_master.id), NOT NULL | 単位ID（個／g／mlなど）               |
| item\_status        | text      | NOT NULL, DEFAULT 'in\_stock' | ステータス（in\_stock / low / out） |
| is\_expiry\_managed | boolean   | NOT NULL, DEFAULT true        | 賞味期限を管理するか                   |
| expiry\_date        | date      | NULLABLE                      | 賞味期限                         |
| jan\_code           | text      | NULLABLE                      | JANコード                       |
| memo                | text      | NULLABLE                      | 任意メモ                         |
| last\_synced\_token | text      | NULLABLE                      | 最終同期トークン                     |
| created_at          | timestamp | NOT NULL                      | 作成日時                         |
| updated\_at         | timestamp | NOT NULL, DEFAULT now()       | 最終更新日時                       |

## unit\_master テーブル

| フィールド名 | 型    | 制約           | 説明               |
| ------ | ---- | ------------ | ---------------- |
| id     | UUID | PK, NOT NULL | 単位ID             |
| name   | text | NOT NULL     | 単位名（個／g／ml／本 など） |

## shopping\_lists テーブル

| フィールド名      | 型         | 制約                        | 説明        |
| ----------- | --------- | ------------------------- | --------- |
| id          | UUID      | PK, NOT NULL              | 買い物リストID  |
| family\_id  | UUID      | FK(families.id), NOT NULL | 所属ファミリーID |
| name        | text      | NOT NULL                  | リスト名      |
| created\_at | timestamp | NOT NULL, DEFAULT now()   | 作成日時      |

## shopping\_list\_items テーブル

| フィールド名             | 型         | 制約                               | 説明                          |
| ------------------ | --------- | -------------------------------- | --------------------------- |
| id                 | UUID      | PK, NOT NULL                     | リスト明細ID                     |
| shopping\_list\_id | UUID      | FK(shopping\_lists.id), NOT NULL | 紐付くリストID                    |
| item\_id           | UUID      | FK(items.id), NULLABLE           | 紐付く食材ID（過去登録済みの場合）          |
| custom\_name       | text      | NULLABLE                         | 自由記述の食材名（item\_idがNULL時に使用） |
| quantity           | integer   | NOT NULL                         | 必要数                         |
| is\_checked        | boolean   | NOT NULL, DEFAULT false          | チェック状態                      |
| updated_at         | timestamp | NOT NULL, DEFAULT now()          |                             |

## usage\_logs テーブル

| フィールド名          | 型         | 制約                        | 説明                    |
| --------------- | --------- | ------------------------- | --------------------- |
| id              | UUID      | PK, NOT NULL              | ログID                  |
| user\_id        | UUID      | FK(profiles.id), NOT NULL | 実行ユーザーID              |
| action\_type    | text      | NOT NULL                  | アクション種別（ocr\_scan など） |
| parameter\_json | jsonb     | NULLABLE                  | 追加パラメータ（OCR精度、ヒット率など） |
| created\_at     | timestamp | NOT NULL, DEFAULT now()   | ログ作成日時                |

## RLS (Row-Level Security) ポリシー概要

* profiles：ユーザー自身のみSELECT/UPDATE可能
* items：profiles.family\_id = items.family\_id のみアクセス可
* shopping\_lists：profiles.family\_id = shopping\_lists.family\_id のみアクセス可
* shopping\_list\_items：shopping\_lists.family\_id = profiles.family\_id のみアクセス可
* usage\_logs：user\_idが一致するレコードのみアクセス可
* families：profiles.family\_id = families.id のみアクセス可

---

## 備考

* storage\_categoryはENUM管理 or Masterテーブル化はPhase2で検討
* unit\_masterの初期データは「個」「g」「ml」「本」「袋」など
* item\_statusは in\_stock / low / out の3値
* is\_expiry\_managed = false の場合、expiry\_dateはNULLでも許容
* last\_synced\_tokenは同期制御用トークン（Supabase Realtime用）
* invite\_codeは家族招待用にhuman-readableな文字列を持たせる
